<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Admin - H·ªá Th·ªëng T∆∞ Duy</title>

    <!-- Th∆∞ vi·ªán xu·∫•t Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f0f2f5;
            padding: 20px;
        }
        .container {
            max-width: 950px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .btn {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .box {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #c8e6c9;
        }
        textarea {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #a5d6a7;
            border-radius: 8px;
            min-height: 150px;
            font-family: monospace;
        }
        select {
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            min-width: 200px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        th {
            background: #2e7d32;
            color: white;
        }
        .guide {
            font-size: 0.9rem;
            background: rgba(255,255,255,0.7);
            padding: 10px;
            border-radius: 6px;
        }
    </style>
</head>

<body>
<div class="container">

    <h1 style="color:#2e7d32;">üß† QU·∫¢N TR·ªä VI√äN</h1>

    <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
        <button class="btn" style="background:#1976d2" onclick="exportExcel()">üì§ XU·∫§T EXCEL</button>
        <button class="btn" style="background:#d32f2f" onclick="clearData()">üóëÔ∏è L√ÄM S·∫†CH</button>
    </div>

    <div class="box">
        <h3>üì• N·∫°p d·ªØ li·ªáu t·ª´ Google Sheets</h3>
        <div class="guide">
            Copy 6 c·ªôt: <b>C√¢u h·ªèi | A | B | C | D | S·ªë ƒë√∫ng (0‚Äì3)</b> r·ªìi d√°n v√†o √¥ d∆∞·ªõi.
        </div>

        <br>
        <label><b>Ch·ªçn m√¥n:</b></label><br>
        <select id="sel-sub">
            <option>Khoa h·ªçc t·ª± nhi√™n</option>
            <option>To√°n</option>
            <option>VƒÉn</option>
            <option>Anh</option>
        </select>

        <textarea id="raw-input" placeholder="D√°n d·ªØ li·ªáu v√†o ƒë√¢y..."></textarea>

        <button class="btn" style="background:#2e7d32; width:100%;" onclick="processData()">
            üíæ PH√ÇN T√çCH & L∆ØU
        </button>
    </div>

    <h3>üóÇÔ∏è Kho c√¢u h·ªèi (<span id="count">0</span>)</h3>

    <table>
        <thead>
            <tr>
                <th width="15%">M√¥n</th>
                <th>C√¢u h·ªèi</th>
                <th width="10%">X√≥a</th>
            </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>

</div>

<script>
/* ==== B·∫¢O M·∫¨T ADMIN ==== */
if (sessionStorage.getItem('admin_login') !== 'true') {
    const pass = prompt("Nh·∫≠p m·∫≠t kh·∫©u admin:");
    if (pass === "123456") {
        sessionStorage.setItem('admin_login', 'true');
    } else {
        location.href = "index.html";
    }
}

/* ==== X·ª¨ L√ù D·ªÆ LI·ªÜU ==== */
function processData() {
    const raw = document.getElementById('raw-input').value.trim();
    const subject = document.getElementById('sel-sub').value;
    if (!raw) return alert("‚ö†Ô∏è Ch∆∞a c√≥ d·ªØ li·ªáu!");

    const rows = raw.split('\n');
    let db = JSON.parse(localStorage.getItem('exam_system_db')) || [];
    let count = 0;

    rows.forEach(row => {
        let cols = row.split('\t');
        if (cols.length < 6) cols = row.split('|');

        if (cols.length >= 6) {
            let correct = parseInt(cols[5]);
            if (!isNaN(correct) && correct >= 0 && correct <= 3) {
                db.push({
                    id: Date.now() + Math.random(),
                    subject: subject,
                    text: cols[0].trim(),
                    options: [
                        cols[1].trim(),
                        cols[2].trim(),
                        cols[3].trim(),
                        cols[4].trim()
                    ],
                    correct: correct
                });
                count++;
            }
        }
    });

    localStorage.setItem('exam_system_db', JSON.stringify(db));
    document.getElementById('raw-input').value = "";
    render();
    alert("‚úÖ ƒê√£ l∆∞u " + count + " c√¢u h·ªèi");
}

/* ==== HI·ªÇN TH·ªä ==== */
function render() {
    const db = JSON.parse(localStorage.getItem('exam_system_db')) || [];
    document.getElementById('count').innerText = db.length;

    document.getElementById('table-body').innerHTML =
        db.slice().reverse().slice(0,50).map((q,i) => `
        <tr>
            <td><b>${q.subject}</b></td>
            <td>${q.text}</td>
            <td>
                <button onclick="del(${db.length-1-i})"
                    style="color:red;border:none;background:none;cursor:pointer;font-weight:bold">
                    X√≥a
                </button>
            </td>
        </tr>
    `).join('');
}

/* ==== X√ìA ==== */
function del(i) {
    let db = JSON.parse(localStorage.getItem('exam_system_db'));
    db.splice(i,1);
    localStorage.setItem('exam_system_db', JSON.stringify(db));
    render();
}

function clearData() {
    if (confirm("‚ö†Ô∏è X√≥a to√†n b·ªô d·ªØ li·ªáu?")) {
        localStorage.removeItem('exam_system_db');
        render();
    }
}

/* ==== XU·∫§T EXCEL ==== */
function exportExcel() {
    const db = JSON.parse(localStorage.getItem('exam_system_db')) || [];
    if (db.length === 0) return alert("‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu!");

    const data = [
        ["M√¥n", "C√¢u h·ªèi", "A", "B", "C", "D", "ƒê√°p √°n ƒë√∫ng"]
    ];

    db.forEach(q => {
        data.push([
            q.subject,
            q.text,
            q.options[0],
            q.options[1],
            q.options[2],
            q.options[3],
            q.correct
        ]);
    });

    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Ng√¢n h√†ng c√¢u h·ªèi");
    XLSX.writeFile(wb, "ngan_hang_cau_hoi.xlsx");
}

window.onload = render;
</script>

</body>
</html>
